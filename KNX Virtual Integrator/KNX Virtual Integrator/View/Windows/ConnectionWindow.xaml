<mah:MetroWindow x:Class="KNX_Virtual_Integrator.View.Windows.ConnectionWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
                 xmlns:viewmodel="clr-namespace:KNX_Virtual_Integrator.ViewModel"
                 d:DataContext="{d:DesignInstance Type=viewmodel:MainViewModel}"
                 mc:Ignorable="d"
                 Title="{DynamicResource ConnectionWindowTitle}" Height="650" Width="300"
                 TitleCharacterCasing="Normal"
                 ResizeMode="NoResize"
                 Background="{StaticResource WhiteBackgroundBrush}"
                 BorderThickness="1.5"
                 BorderBrush="{StaticResource KnxGreenBrush}"
                 WindowTitleBrush="{StaticResource KnxGreenBrush}"
                 NonActiveWindowTitleBrush="{StaticResource KnxLightGreenBrush}"
                 Closing="ClosingConnectionWindow">

    <Window.Resources>

        <!-- Style pour les interfaces dÃ©couvertes -->
        <DataTemplate x:Key="ListBoxItemLight" DataType="{x:Type viewmodel:ConnectionInterfaceViewModel}">
            <TextBlock Name="InterfaceItemsText" Text="{Binding Path=DisplayName}"
                       Style="{StaticResource ItalicTextBlockLight}" />
        </DataTemplate>

        <DataTemplate x:Key="ListBoxItemDark" DataType="{x:Type viewmodel:ConnectionInterfaceViewModel}">
            <TextBlock Name="InterfaceItemsText" Text="{Binding Path=DisplayName}"
                       Style="{StaticResource ItalicTextBlockDark}" />
        </DataTemplate>

        <!-- Styles pour l'interface dÃ©couverte liÃ©e au DisconnectButton -->
        <Style x:Key="InterfaceTextBlockLight" TargetType="TextBlock" BasedOn="{StaticResource ItalicTextBlockLight}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding ElementName=DisconnectButton, Path=IsEnabled}" Value="True">
                    <Setter Property="Foreground" Value="{StaticResource KnxGreenBrush}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding ElementName=DisconnectButton, Path=IsEnabled}" Value="False">
                    <Setter Property="Foreground" Value="{Binding Tag, RelativeSource={RelativeSource Self}}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- ReSharper disable once Xaml.RedundantResource -->
        <Style x:Key="InterfaceTextBlockDark" TargetType="TextBlock" BasedOn="{StaticResource ItalicTextBlockDark}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding ElementName=DisconnectButton, Path=IsEnabled}" Value="True">
                    <Setter Property="Foreground" Value="{StaticResource KnxGreenBrush}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding ElementName=DisconnectButton, Path=IsEnabled}" Value="False">
                    <Setter Property="Foreground" Value="{StaticResource DarkForegroundBrush}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Styles pour les textes de la fenÃªtre -->
        <Style x:Key="TextBoxLight" TargetType="TextBox" BasedOn="{StaticResource StandardTextBoxLight}">
            <Setter Property="Width" Value="80" />
            <Setter Property="Height" Value="20" />
            <Setter Property="FontSize" Value="12" />
        </Style>
        
        <!-- ReSharper disable once Xaml.RedundantResource -->
        <Style x:Key="TextBoxDark" TargetType="TextBox" BasedOn="{StaticResource StandardTextBoxDark}">
            <Setter Property="Width" Value="80" />
            <Setter Property="Height" Value="20" />
            <Setter Property="FontSize" Value="12" />
        </Style>

    </Window.Resources>

    <ScrollViewer BorderBrush="{StaticResource KnxGreenBrush}"
            BorderThickness="0" x:Name="ConnectionWindowBorder"
            VerticalScrollBarVisibility="Auto"
            CanContentScroll="False"
            PanningMode="VerticalOnly">
        <Grid >
            <!-- Define rows and columns for the grid -->
            <Grid.RowDefinitions>
                <RowDefinition Height="50"/>    <!-- Bus Connection Type Selection Section -->
                <RowDefinition Height="Auto"/>  <!-- Discovered Interfaces Section -->
                <RowDefinition Height="Auto"/>  <!-- Section connexion Ã  distance-->
                <RowDefinition Height="*"/>     <!-- Section connexion IP Secure-->
                <RowDefinition Height="Auto"/>  <!-- Error Message Section -->
                <RowDefinition Height="Auto"/>  <!-- Current Interface Display Section -->
                <RowDefinition Height="50"/>    <!-- Section for connection and disconnection -->
            </Grid.RowDefinitions>

            <!-- Bus Connection Type Selection Section -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="10,5">
                <TextBlock Name="ConnectionTypeText"
                           Text="{DynamicResource ConnectionType}"
                           VerticalAlignment="Center"
                           Margin="0,0,10,0" />
                <ComboBox Name="ConnectionTypeComboBox"
                          Style="{StaticResource LightComboBoxStyle}"
                          Width="120" Height="25"
                          VerticalAlignment="Center"
                          FontSize="10"
                          SelectedIndex="0" 
                          SelectedItem="{Binding SelectedConnectionType, Mode=TwoWay}"
                          ItemsSource="{Binding ConnectionTypes}"/>
            </StackPanel>

            <!-- Discovered Interfaces Section -->
            <StackPanel Grid.Row="1" Orientation="Vertical" HorizontalAlignment="Center" Margin="10"
                        Visibility="{Binding DiscoveredInterfacesVisibility}">
                <Grid Margin="3,0,3,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Name="DiscoveredInterfacesText" Text="{DynamicResource AvailableInterfaces}" HorizontalAlignment="Left"
                               VerticalAlignment="Center" Margin="0,0,0,0" Grid.Column="0" />

                    <Button Grid.Column="1" Command="{Binding RefreshInterfacesCommand}"
                            Style="{StaticResource RefreshButtonStyle}"
                            Padding="10,0"
                            Margin="0,0,0,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âŸ²" FontSize="12" Height="20" Margin="0,2,5,0" VerticalAlignment="Center" />
                            <TextBlock Text="{DynamicResource Refresh}" FontSize="10" VerticalAlignment="Center" Margin="0,0,0,0" />
                        </StackPanel>
                    </Button>
                </Grid>

                <!-- List of discovered interfaces -->
                <ListBox Name="InterfaceListBox" Width="250" Height="120"
                         Style="{StaticResource StandardListBoxLight}"
                         ItemsSource="{Binding DiscoveredInterfaces}"
                         SelectedItem="{Binding SelectedInterface}"
                         SelectionMode="Single"
                         ItemContainerStyle="{StaticResource ListBoxContainerLight}"
                         ItemTemplate="{StaticResource ListBoxItemLight}">
                    <!-- ItemTemplate pour afficher les donnÃ©es -->
                </ListBox>
            </StackPanel>

            <!-- Section connexion Ã  distance-->
            <Grid Grid.Row="2" HorizontalAlignment="Center" Visibility="{Binding RemoteConnexionVisibility}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="90" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="30" />
                    <RowDefinition Height="40" />
                    <RowDefinition Height="40" />
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock
                        Name="NatIconText"
                        Text="ðŸ–§"
                        Foreground="{StaticResource LightForegroundBrush}"
                        TextAlignment="Left"
                        VerticalAlignment="Center" />
                    <TextBlock
                        Name="NatConnectionText"
                        Text="{DynamicResource NatConnection}"
                        Foreground="{StaticResource LightForegroundBrush}"
                        Margin="5,0,0,0"
                        TextAlignment="Left"
                        FontWeight="SemiBold"
                        VerticalAlignment="Center" />
                </StackPanel>


                <Image Grid.Row="0" Grid.Column="1"
                       Style="{StaticResource TooltipImage}"
                       Height="15"
                       VerticalAlignment="Center"
                       HorizontalAlignment="Right">
                    <ToolTipService.ToolTip>
                        <ToolTip HorizontalOffset="10" VerticalOffset="20" 
                                 Background="{DynamicResource CurrentTooltipBackgroundBrush}"
                                 BorderBrush="{StaticResource KnxGreenBrush}">
                            <StackPanel Orientation="Vertical">
                                <TextBlock Foreground="{StaticResource KnxGreenBrush}"
                                           FontWeight="SemiBold"
                                           Text="{DynamicResource RemoteConnectionTooltipTitle}"/>
                                <TextBlock Style="{DynamicResource CurrentTooltipTextBlockStyle}"
                                           Text="{DynamicResource RemoteConnectionTooltipMessage}"/>
                            </StackPanel>
                        </ToolTip>
                    </ToolTipService.ToolTip>
                </Image>

                <TextBlock Name="IpRouterText" Grid.Row="1" Grid.Column="0"
                           Foreground="{StaticResource LightForegroundBrush}"
                           Text="{DynamicResource PublicIp}"
                           VerticalAlignment="Center"
                           TextAlignment="Left" />

                <TextBox Name="NatAddressTextBox" Grid.Row="1" Grid.Column="1"
                         Style="{StaticResource TextBoxLight}"
                         Width="90"
                         Text="{Binding BusConnection.NatAddress, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                
                <TextBlock Name="IndivAddressText" Grid.Row="2" Grid.Column="0"
                           Foreground="{StaticResource LightForegroundBrush}"
                           Text="{DynamicResource IndivAddressInterface}"
                           VerticalAlignment="Center"
                           TextAlignment="Left" />

                <TextBox Name="IndivAddressTextBox" Grid.Row="2" Grid.Column="1"
                         Style="{StaticResource TextBoxLight}"
                         Width="70"
                         Text="{Binding BusConnection.InterfaceAddress, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            </Grid>
            
            <!-- Section connexion IP Secure-->
            <Border Grid.Row="3"
                    Name="IPSecureBorder"
                    BorderBrush="{StaticResource DarkGrayBorderBrush}"
                    BorderThickness="0,1,0,0"
                    Margin="22,10,22,0"
                    Visibility="{Binding SecureConnectionVisibility}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- Warning message -->
                        <RowDefinition Height="Auto"/> <!-- Section title -->
                        <RowDefinition Height="Auto"/> <!-- .knxkeys import -->
                        <RowDefinition Height="Auto"/> <!-- imported file title -->
                        <RowDefinition Height="Auto"/> <!-- imported file name -->
                        <RowDefinition Height="Auto"/> <!-- keys file password -->
                    </Grid.RowDefinitions>
                    
                    <!-- Warning message -->
                    <TextBlock Grid.Row="0"
                               Name="SecurisedConnectionText"
                               Foreground="{StaticResource LightForegroundBrush}"
                               VerticalAlignment="Center"
                               TextAlignment="Left"
                               FontStyle="Italic"
                               Margin="0,5,0,5"
                               Text="{DynamicResource ToFillWhenSecure}"/>
                    
                    <!-- Section title -->
                    <Grid Grid.Row="1" Margin="0,0,0,5">
                        <StackPanel HorizontalAlignment="Left" Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Name="LockIconText"
                                       Text="ðŸ”’"
                                       Foreground="{StaticResource LightForegroundBrush}"
                                       FontWeight="SemiBold"
                                       TextAlignment="Left"
                                       VerticalAlignment="Center"/>
                            <TextBlock Name="ConnectionIpSecText"
                                       Text="{DynamicResource IPSecureConnection}"
                                       Foreground="{StaticResource LightForegroundBrush}"
                                       Margin="5,0,0,0"
                                       TextAlignment="Left"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                        <Image HorizontalAlignment="Right"
                               Style="{StaticResource TooltipImage}"
                               Height="15"
                               VerticalAlignment="Center">
                            <ToolTipService.ToolTip>
                                <ToolTip HorizontalOffset="10" VerticalOffset="20"
                                         Background="{DynamicResource CurrentTooltipBackgroundBrush}"
                                         BorderBrush="{StaticResource KnxGreenBrush}">
                                    <StackPanel Orientation="Vertical">
                                        <TextBlock Foreground="{StaticResource KnxGreenBrush}"
                                                   FontWeight="SemiBold"
                                                   Text="{DynamicResource SecureConnectionTooltipTitle}"/>
                                        <TextBlock Style="{DynamicResource CurrentTooltipTextBlockStyle}"
                                                   Text="{DynamicResource SecureConnectionTooltipMessage}"/>
                                    </StackPanel>
                                </ToolTip>
                            </ToolTipService.ToolTip>
                        </Image>
                    </Grid>
                        
                    <!-- .knxkeys import -->
                    <Grid Grid.Row="2">
                        <TextBlock HorizontalAlignment="Left"
                                   Name="FileKeysText"
                                   Text="{DynamicResource KnxKeysFile}"
                                   VerticalAlignment="Center"
                                   TextAlignment="Left" />

                        <Button HorizontalAlignment="Right"
                                Name="ImportKnxKeys"
                                Style="{StaticResource ImportKeysButtonLight}"
                                Click="ImportKeysFileButtonClick">
                            <TextBlock Text="{DynamicResource ImportKeys}"
                                       Width="78"
                                       FontSize="10"
                                       TextAlignment="Center"
                                       VerticalAlignment="Center" />
                        </Button>
                    </Grid>
                    
                    <!-- imported file title and name -->
                    <Border Grid.Row="3"
                            BorderBrush="{StaticResource LightGrayBorderBrush}"
                            BorderThickness="1,0,0,1"
                            Margin="5,2,0,5">
                        <StackPanel Orientation="Vertical">
                            <!-- imported file title -->
                            <TextBlock Margin="6,0,0,0"
                                       Name="ImportedKeysFileText"
                                       FontStyle="Italic"
                                       FontSize="10"
                                       Text="{DynamicResource ImportedKeysFile}"/>
                            <!-- imported file name -->
                            <TextBlock
                                Name="ImportKeyPathText"
                                Margin="5,0,0,2"
                                Text="{Binding BusConnection.KeysPath}"
                                TextAlignment="Left"
                                FontSize="10"
                                TextWrapping="Wrap">
                            </TextBlock>
                        </StackPanel>
                    </Border>
                    
                    <!-- keys file password -->
                    <Grid Grid.Row="5"  Height="30">

                        <TextBlock HorizontalAlignment="Left"
                                   Name="PwdKeysFileText"
                                   Text="{DynamicResource PwdKeys}"
                                   VerticalAlignment="Center" />

                        <TextBox HorizontalAlignment="Right"
                                 Name="ActualPwdKeysFileTextBox"
                                 Style="{StaticResource TextBoxLight}"
                                 Text="{Binding BusConnection.KeysFilePassword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    </Grid>
                </Grid>
            </Border>
                
            <!-- Error Message Section -->
            <StackPanel Grid.Row="4" Orientation="Vertical" HorizontalAlignment="Left" Margin="20,0"
                        Visibility="{Binding ConnectionErrorMessageVisibility}">
                <TextBlock
                    Text="{DynamicResource ConnectionError}"
                    FontWeight="Bold"
                    Foreground="Red" />
                <TextBlock
                    Text="{Binding BusConnection.ConnectionErrorMessage}"
                    FontWeight="SemiBold"
                    Foreground="Red"
                    TextWrapping="Wrap" />
            </StackPanel>

            <!-- Current Interface Display Section -->
            <StackPanel Grid.Row="5" Orientation="Vertical" HorizontalAlignment="Left" Margin="20,10" Width="250"
                        Name="CurIntText">
                <TextBlock
                    Name="CurrentInterfaceText"
                    Margin="5,0,5,0"
                    Text="{DynamicResource CurrentInterface}"
                    TextAlignment="Left"
                    FontWeight="SemiBold" />
                <StackPanel Orientation="Vertical">
                    <TextBlock
                        Name="CurrCoInterfaceText"
                        Margin="5,0"
                        Text="{Binding Path=CurrentInterface}"
                        Style="{StaticResource InterfaceTextBlockLight}"
                        TextAlignment="Left"
                        TextWrapping="Wrap"
                        FontWeight="SemiBold" />
                </StackPanel>
            </StackPanel>
            
            <!-- Section for connection and disconnection -->
            <Grid Grid.Row="6" Margin="20,0" VerticalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" /> <!-- Colonne pour le bouton de dÃ©connexion -->
                    <ColumnDefinition Width="*" /> <!-- Colonne pour le bouton de connexion -->
                </Grid.ColumnDefinitions>

                <!-- Bouton DÃ©connexion, collÃ© Ã  gauche -->
                <Button Grid.Column="0" Name="DisconnectButton" Content="{DynamicResource DisconnectButtonText}"
                        Style="{StaticResource DisconnectButton}"
                        Margin="5" Padding="5,2"
                        Command="{Binding DisconnectBusCommand}"
                        IsEnabled="{Binding IsConnected}"
                        HorizontalAlignment="Left" />

                <!-- Bouton Connexion, collÃ© Ã  droite -->
                <Button Grid.Column="1" Name="ConnectButton" Content="{DynamicResource ConnectButtonText}"
                        Style="{StaticResource ConnectButton}"
                        Margin="5" Padding="5,2"
                        Foreground="{StaticResource DarkForegroundBrush}"
                        Command="{Binding ConnectBusCommand}"
                        HorizontalAlignment="Right"
                        IsDefault="True"/>
            </Grid>
            
        </Grid>
    </ScrollViewer>

</mah:MetroWindow>